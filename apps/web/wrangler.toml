# Cloudflare Workers configuration
name = "qademo"
main = "src/worker/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat", "nodejs_als"]

# Static Assets configuration (replaces Pages)
[assets]
directory = "dist"
binding = "ASSETS"

# Serve index.html for SPA routes
not_found_handling = "single-page-application"

# Version metadata binding for Sentry release tracking
[version_metadata]
binding = "CF_VERSION_METADATA"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "qademo-db"
database_id = "7d737bba-ca52-46fd-9f28-2c55e3adfd26"

# R2 Bucket for product images
# Create with: wrangler r2 bucket create qademo-images
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "qademo-images"

# KV Namespace for sessions and caching
[[kv_namespaces]]
binding = "KV_SESSIONS"
id = "b458b9cf54f341c68081c9958f5314ad"

# Environment variables (non-secret)
[vars]
ENVIRONMENT = "production"

# Secrets to set via: wrangler secret put JWT_SECRET
# JWT_SECRET = "your-super-secret-jwt-key"

# Development settings
[dev]
port = 8787
local_protocol = "http"

# Build settings - build is handled by deploy script, not wrangler
# This avoids duplicate builds during deployment

# Observability
[observability]
enabled = true

# Enable source map uploads for Sentry
upload_source_maps = true
